{% extends "base.html" %}

{% block title %}标签 - {{ site.name }}{% endblock %}

{% block content %}
    <h2>所有标签</h2>
    <ul class="post-list">
        {% for tag in all_tags %}
        <li class="post-item">
            <a href="tags.html?tag={{ tag.name | urlencode }}">{{ tag.name }}</a>
            （{{ tag.count }}）
        </li>
        {% endfor %}
    </ul>

    <hr />
    <div id="filtered">
        <h3 id="tag-title">标签文章</h3>
        <ul class="post-list" id="tag-posts">
            {% for post in posts %}
            <li class="post-item" data-tags='{{ post.tags | default(value=[]) | json_encode() }}'>
                <a href="{{ post.slug }}.html">{{ post.title | default(value=post.slug) }}</a>
            </li>
            {% endfor %}
        </ul>
    </div>

    <script>
    (function() {
        function getParam(name) {
            const url = new URL(window.location.href);
            return url.searchParams.get(name);
        }
        const tag = getParam('tag');
        const title = document.getElementById('tag-title');
        const list = document.getElementById('tag-posts');
        if (!tag) {
            title.textContent = '请选择上方任意标签查看相关文章';
            return;
        }
        title.textContent = '标签：' + tag + ' 的文章';
        const items = list.querySelectorAll('li.post-item');
        items.forEach(function(li) {
            let tags = [];
            try {
                tags = JSON.parse(li.getAttribute('data-tags') || '[]');
            } catch (e) {}
            if (tags.indexOf(tag) === -1) {
                li.style.display = 'none';
            }
        });
    })();
    </script>
{% endblock %}


